clear all ;
clc;
%% 本例也采用红外光谱预测辛烷值的例子
load iris_data.mat

%% 划分数据集
%这里需要注意和前面的不同，这里需要分段划分
P_train=[];
T_train=[];
P_test=[];
T_test=[];
for i=1:3  %for 循环分段划分，然后再拼接到一起
    temp_input=features((i-1)*50+1:i*50,:);
    temp_output=classes((i-1)*50+1:i*50,:);
    n=randperm(50);
    % 训练集--120个样本
    P_train=[P_train,temp_input(n(1:40),:)'];
    T_train=[T_train,temp_output(n(1:40),:)'];
    % 测试集--30个样本
    P_test=[P_test,temp_input(n(41:50),:)'];
    T_test=[T_test,temp_output(n(41:50),:)'];
    %仔细体会一下这一段关于多标签分类的数据集的划分
end
%% 模型建立
result_grnn=[];
result_pnn=[];
time_grnn=[];
time_pnn=[];
for i=1:4
    for j=i:4  %%仔细思考一下这里的j=1：4，因为没有必要自己和自己作为
        p_train=P_train(i:j,:);  %对四个特征进行排列组合，例如取[1,2]、[1,2,3]、[1,2,3,4]等不同的特征
        p_test=P_test(i:j,:);
        %% 1、创建GRNN及仿真测试
        t=cputime;
        %创建网络
        net_grnn=newgrnn(p_train,T_train);
        % 仿真测试
        t_sim_grnn=sim(net_grnn,p_test);
        T_sim_grnn=round(t_sim_grnn);%本例是分类问题，所以要取整
        t=cputime-t;
        time_grnn=[time_grnn t];  %通过不同的特征的排列组合来看神经网络仿真所花费的时间和仿真效果，以此来选择最合适的特征选择策略
        result_grnn=[result_grnn,T_sim_grnn'];
        %% 
        % 2、创建pnn以及仿真
        t=cputime;
        Tc_train=ind2vec(T_train);  % 这是概率神经网络里面特有的处理
        %创建网络
        net_pnn=newpnn(p_train,Tc_train);
        % 仿真测试
        Tc_test=ind2vec(T_test);
        t_sim_pnn=sim(net_pnn,p_test);
        T_sim_pnn=vec2ind(t_sim_pnn); %反向操作
        t=cputime-t;
        time_pnn=[time_pnn,t];
        result_pnn=[result_pnn,T_sim_pnn'];
    end
end

%% 性能评价
% 1、正确率accuracy
accuracy_grnn=[];
accuracy_pnn=[];
time=[];
for i=1:10
    accuracy_1=length(find(result_grnn(:,i)==T_test'))/length(T_test);
    %find函数，如果两个矩阵里面对应值是一样的，则返回1，比一样的返回0
    accuracy_2=length(find(result_pnn(:,i)==T_test'))/length(T_test);
    accuracy_grnn=[accuracy_grnn, accuracy_1];
    accuracy_pnn=[accuracy_pnn, accuracy_2];
end
%% 结果对比
result=[T_test',result_pnn,result_grnn];
accuracy=[accuracy_pnn;accuracy_grnn];
time=[time_pnn;time_grnn];

%% 画图
figure(1);
plot(1:30,T_test,'b--o',1:30,result_pnn(:,4),'r-*',1:30,result_grnn(:,4),'k--^')
grid on
xlabel('测试集样本编号')
ylabel('测试集样本类别')
string={'测试集预测结果对比GRNN vs PNN',['正确率',num2str(accuracy_grnn(4)*100) '%(GRNN)vs' num2str(accuracy_pnn(4)*100) '%PNN']};
title(string)
legend('真实值','PNN预测值','GRNN预测值')
figure(2);
plot(1:10,accuracy(1,:),'r-*',1:10,accuracy(2,:),'b:o')
grid on ;
xlabel('模型编号')
ylabel('测试集正确率')
title('10个模型（不同特征的组合）的测试集正确率对比（GRNN vs PNN）')
legend('PNN','GRNN')
figure(3)
plot(1:10,time(1,:),'r-*',1:10,time(2,:),'b:o')
legend('PNN','GRNN')
xlabel('模型编号')
ylabel('消耗的时间(s)')
title('10个模型（不同特征的组合）的测试集消耗的时间对比（GRNN vs PNN）')
